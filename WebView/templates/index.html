<!--
	...previous history goes here
	4/10 9:30pm JTS - fixed initial state of the on/off button by adding a js function afterr the ajax get is called
	...new history goes here
-->
<html>
	<head>
		<title>Person Identification System</title>
		<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
		<link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
		<script type=text/javascript src="{{url_for('static', filename='jquery.js') }}"></script>
		<script type=text/javascript>
			$(function() {
				$('a#camera0').bind('click', function() {
					$('#right').load('/home');
					return false;
				});
				{% for c in camera_list %}
				$.get('http://{{c.getIP()}}:5001/', function() {
					$('a#camera{{c.getID()}}_power').html('on')
				});
				$('a#camera{{c.getID()}}_power').bind('click', function() {
					if ($('a#camera{{c.getID()}}_power').html() == 'on') {
						$.get('http://{{c.getIP()}}:5001/shutdown', function() {
								$('a#camera{{c.getID()}}_power').html('off');
						});
					} else {
						$.get('http://{{c.getIP()}}:5001/', function() {
								$('a#camera{{c.getID()}}_power').html('on');
						});
					}
					return false;
				});
				$('a#camera{{c.getID()}}').bind('click', function() {
					$('#right').load('/view_camera/{{c.getID()}}');
					return false;
				});
				{% endfor %}
				setInterval(function() {
					$.getJSON('/poll_for_status', function( cameras ) {
						for (var c of $('.indicator')) {
							c.src="/static/red_indicator.png";
						}
						for (var c of cameras) {
							var id = '#camera'+c+'_indicator';
							$(id).attr('src', "/static/green_indicator.png");
						}
					});
				}, 3000);
			});
		</script>
	</head>
	<body>
		<h1>Main View</h1>
		<div id="center">
			<div id="left">
				<h3>Cameras</h3>
				<ul>
					<li><a id="camera0" href="#">Home</a></li>
				{% for c in camera_list %}
					<li><a id="camera{{c.getID()}}" href="#">Camera {{c.getID()}}</a> - <a id="camera{{c.getID()}}_power" href="#">{{"on" if c.isOnline() else "off"}}</a> <img class="indicator" id="camera{{c.getID()}}_indicator" src="{{url_for('static', filename='green_indicator.png' if c.hasMotion() else 'red_indicator.png')}}"/></li>
				{% endfor %}
				</ul>
			</div>
			<div id="right">
				{{ home_content }}
			</div>
		</div>
		<div style="clear: left"/>
		<div id="bottom">
			<h3>Activity Log</h3>
			<div id="activity_log"></div>
		</div>
		<span>{{database_ip}}</span>
	</body>
</html>